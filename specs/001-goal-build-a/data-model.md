# Data Model Specification: Quantitative Trading System

## Core Entities

### 1. MarketData
**Purpose**: Represents time-series market data for trading instruments

**Attributes**:
- `symbol`: str - Trading symbol/ticker (e.g., "AAPL", "EUR/USD")
- `timestamp`: datetime - Observation timestamp
- `open`: float - Opening price
- `high`: float - Highest price
- `low`: float - Lowest price
- `close`: float - Closing price
- `volume`: float - Trading volume
- `adjusted_close`: float - Dividend-adjusted close (equities only)
- `data_source`: str - Source of data (e.g., "yahoo", "quandl", "fred")
- `quality_score`: float - Data quality metric (0.0-1.0)

**Constraints**:
- Symbol must follow exchange format
- Prices must be positive numbers
- Volume must be non-negative
- Timestamp must be in chronological order

### 2. TradingSignal
**Purpose**: Represents trading signals generated by strategies

**Attributes**:
- `signal_id`: str - Unique signal identifier
- `strategy_id`: str - Strategy that generated the signal
- `symbol`: str - Target instrument
- `signal_type`: str - "BUY", "SELL", "HOLD"
- `signal_strength`: float - Confidence score (0.0-1.0)
- `timestamp`: datetime - Signal generation time
- `expiration_time`: datetime - Signal validity period
- `entry_price`: float - Suggested entry price
- `target_price`: float - Suggested target price
- `stop_loss`: float - Suggested stop loss price
- `indicators`: dict - Technical indicators used for signal

**Constraints**:
- Signal type must be valid enum
- Confidence score must be between 0 and 1
- Expiration time must be after timestamp
- Entry price must be positive

### 3. PortfolioPosition
**Purpose**: Represents current portfolio holdings

**Attributes**:
- `position_id`: str - Unique position identifier
- `symbol`: str - Instrument symbol
- `quantity`: float - Number of shares/contracts
- `entry_price`: float - Average entry price
- `current_price`: float - Current market price
- `unrealized_pnl`: float - Unrealized profit/loss
- `realized_pnl`: float - Realized profit/loss
- `position_type`: str - "LONG", "SHORT"
- `entry_time`: datetime - Position entry timestamp
- `last_update`: datetime - Last update timestamp
- `strategy_id`: str - Strategy that opened position

**Constraints**:
- Quantity cannot be zero
- Entry price must be positive
- Position type must be valid enum

### 4. TradeOrder
**Purpose**: Represents trade execution orders

**Attributes**:
- `order_id`: str - Unique order identifier
- `symbol`: str - Instrument symbol
- `order_type`: str - "MARKET", "LIMIT", "STOP", "STOP_LIMIT"
- `direction`: str - "BUY", "SELL"
- `quantity`: float - Order quantity
- `limit_price`: float - Limit price (if applicable)
- `stop_price`: float - Stop price (if applicable)
- `status`: str - "PENDING", "FILLED", "CANCELLED", "REJECTED"
- `fill_price`: float - Actual fill price
- `fill_time`: datetime - Order fill timestamp
- `commission`: float - Trading commission
- `strategy_id`: str - Strategy that generated order

**Constraints**:
- Quantity must be positive
- Fill price must be positive (if filled)
- Status must be valid enum

### 5. RiskMetrics
**Purpose**: Represents portfolio risk calculations

**Attributes**:
- `portfolio_id`: str - Portfolio identifier
- `timestamp`: datetime - Calculation timestamp
- `var_95`: float - 95% Value at Risk
- `var_99`: float - 99% Value at Risk
- `cvar_95`: float - 95% Conditional Value at Risk
- `beta`: float - Portfolio beta
- `volatility`: float - Portfolio volatility
- `sharpe_ratio`: float - Risk-adjusted return
- `max_drawdown`: float - Maximum drawdown
- `correlation_matrix`: dict - Asset correlation matrix

**Constraints**:
- All risk metrics must be numeric
- Volatility must be non-negative
- Correlation matrix must be valid

### 6. StrategyConfig
**Purpose**: Represents strategy configuration parameters

**Attributes**:
- `strategy_id`: str - Unique strategy identifier
- `strategy_name`: str - Human-readable strategy name
- `strategy_type`: str - "MOMENTUM", "MEAN_REVERSION", "PORTFOLIO_OPT"
- `parameters`: dict - Strategy-specific parameters
- `risk_limits`: dict - Risk management limits
- `data_sources`: list - Required data sources
- `timeframes`: list - Trading timeframes
- `active`: bool - Strategy activation status
- `created_at`: datetime - Creation timestamp
- `updated_at`: datetime - Last update timestamp

**Constraints**:
- Strategy type must be valid enum
- Risk limits must be properly defined
- Timeframes must be valid intervals

### 7. DataPipelineStatus
**Purpose**: Represents data pipeline operational status

**Attributes**:
- `pipeline_id`: str - Pipeline identifier
- `status`: str - "RUNNING", "STOPPED", "ERROR", "MAINTENANCE"
- `last_update`: datetime - Last status update
- `data_sources`: dict - Data source status
- `processing_rate`: float - Data points per second
- `error_count`: int - Error count
- `warning_count`: int - Warning count
- `throughput`: float - Processing throughput
- `latency`: float - Average processing latency

**Constraints**:
- Status must be valid enum
- All numeric metrics must be non-negative
- Timestamp must be current

## Relationships

### One-to-Many Relationships
1. **StrategyConfig** → **TradingSignal** (1:N)
2. **TradingSignal** → **TradeOrder** (1:N)
3. **TradeOrder** → **PortfolioPosition** (1:N)
4. **MarketData** → **TradingSignal** (1:N)

### Many-to-One Relationships
1. **PortfolioPosition** → **RiskMetrics** (N:1)
2. **TradingSignal** → **StrategyConfig** (N:1)
3. **MarketData** → **DataPipelineStatus** (N:1)

### Data Flow
1. **MarketData** → **StrategyConfig** → **TradingSignal**
2. **TradingSignal** → **TradeOrder** → **PortfolioPosition**
3. **PortfolioPosition** → **RiskMetrics** (continuous calculation)

## Data Quality Rules

### Validation Rules
1. **Data Completeness**: No missing values in required fields
2. **Data Consistency**: Cross-field validation (e.g., low ≤ high)
3. **Data Timeliness**: Maximum 1-minute latency for real-time data
4. **Data Accuracy**: Price validation within reasonable bounds

### Anomaly Detection
1. **Price Jumps**: >10% movement in single period
2. **Volume Spikes**: >5x average volume
3. **Data Gaps**: Missing data points >5 minutes
4. **Stale Data**: Data older than 1 hour

## Data Storage Considerations

### Time-Series Data
- **MarketData**: Store in time-series database for efficient queries
- **RiskMetrics**: Store with rolling window retention
- **DataPipelineStatus**: Store with short-term retention

### Transactional Data
- **TradeOrder**: ACID compliance required
- **PortfolioPosition**: Real-time updates needed
- **TradingSignal**: Short-term retention for backtesting

### Configuration Data
- **StrategyConfig**: Version control integration
- **RiskParameters**: Immutable storage with audit trail

## Performance Requirements

### Query Performance
- **MarketData**: <100ms for 1-year historical query
- **PortfolioPosition**: <10ms for current state query
- **RiskMetrics**: <50ms for portfolio risk calculation

### Throughput Requirements
- **Data Ingestion**: 10,000+ data points per second
- **Signal Processing**: 1,000+ signals per second
- **Risk Calculation**: Real-time updates for 100+ portfolios

## Data Security

### Access Control
- Role-based access control for different data types
- Encryption for sensitive configuration data
- Audit logging for all data modifications

### Compliance
- Data retention policies for regulatory compliance
- Backup and disaster recovery procedures
- Data privacy protection for personal information